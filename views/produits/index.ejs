<% include ../partials/header %>

<header class="jumbotron">
    <div class="container">
        <div class="center">
        <h1><i class="fas fa-search"></i> ANALYSE DES PRODUITS </h1>
            <p><a>Produits à analyser</a></p>
        </div>

        <% if((typeof (currentUser) !="undefined")) {%>
            <% if((currentUser.role ==="admin") || (currentUser.role ==="agent")) {%>
                <p class="<%= typeof page !== 'undefined' && page === 'produits' ? 'active' : '' %>"><a class="btn btn-success btn-md pull-right"
                                                                                                      href="/produits/new">Ajouter un nouveau produit  <span class="glyphicon glyphicon glyphicon-plus" aria-hidden="true"></span></a></p>
            <% } %>
        <% } %>

        <p>
        <form action="/produits" method="GET" class="form-inline">
            <div class="form-group">
                <input class="searchbar" type="text" name="search" placeholder="Chercher par IMEI..."
                       class="form-control">
                <input type="submit" value="Chercher" class="btn btn-default col-sm-pull-left">
            </div>
        </form>
        </p>
    </div>
</header>

<div class="row text-center" style="display:flex; flex-wrap: wrap">

    <% produits.forEach(produit => { %>
    <% if ((produit.publication === "Publié")) { %>

    <div class="col-lg-3 col-md-4 col-sm-6">

        <% if (produit.image.length === 3){ %>
        <div class="thumbnail">
            <a style="margin-top:5px;" class="btn btn-primary" data-toggle="collapse" href="#collapseExample3<%=produit._id%>" role="button" aria-expanded="false" aria-controls="collapseExample">Apperçu du produit  <span class="glyphicon glyphicon glyphicon-eye-open" aria-hidden="true"></span>
            </a>
            <br>
            <p></p>
            <div class="collapse" id="collapseExample3<%=produit._id%>">
            <div id="carousel-example-generic3<%=produit._id%>" class="carousel slide" data-ride="carousel">
                <!-- Indicators -->
                <ol class="carousel-indicators">
                    <li data-target="#carousel-example-generic3<%=produit._id%>" data-slide-to="0" class="active"></li>
                    <li data-target="#carousel-example-generic3<%=produit._id%>" data-slide-to="1"></li>
                    <li data-target="#carousel-example-generic3<%=produit._id%>" data-slide-to="2"></li>
                </ol>

                <!-- Wrapper for slides -->
                <div style="max-height:200px;min-height:200px" class="carousel-inner" role="listbox">
                    <div class="item active fixed-height">
                        <img src="<%= produit.image[0] %>" alt="image 1">
                        <div class="carousel-caption">
                        </div>
                    </div>
                    <div class="item fixed-height">
                        <img src="<%= produit.image[1] %>" alt="image 2">
                        <div class="carousel-caption">
                        </div>
                    </div>
                    <div class="item fixed-height">
                        <img src="<%= produit.image[2] %>" alt="image 3">
                        <div class="carousel-caption">
                        </div>
                    </div>
                </div>

                <!-- Controls -->
                <a class="left carousel-control" href="#carousel-example-generic3<%=produit._id%>" role="button" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="right carousel-control" href="#carousel-example-generic3<%=produit._id%>" role="button" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
            </div>

            <div class="caption">
                <h4> IMEI : <br>
                    <a><%= produit.imei %></a>
                </h4>
                <h4> Intitulé : <br>
                    <a><%= produit.name %></a>
                </h4>
                <!-- Produit Like Rating -->
                <div>
                    <span class="badge label-primary"><i class="fas fa-thumbs-up"></i>
                        <%= produit.likes.length %></span>
                </div>
                <p></p>
                <!-- Produit Star Rating -->
                <% if (produit.rating === 0) { %>
                <p></p>
                <h4>Pas d'évaluations encore.</h4>
                <% } else { %>
                <span class="fa fa-star checked"></span>
                <span class="fa fa-star <% if (produit.rating > 1.5) { %> checked <% } %>"></span>
                <span class="fa fa-star <% if (produit.rating > 2.5) { %> checked <% } %>"></span>
                <span class="fa fa-star <% if (produit.rating > 3.5) { %> checked <% } %>"></span>
                <span class="fa fa-star <% if (produit.rating > 4.5) { %> checked <% } %>"></span>
                <% } %>


                <p></p>
            <p>
                <a href="/produits/<%= produit._id %>" class="btn btn-success">Plus d'infos</a>
            </p>

           </div>

        </div>


        <% } %>
            <% if(produit.image.length === 2){ %>
                <div class="thumbnail">
                    <a style="margin-top:5px;" class="btn btn-primary" data-toggle="collapse" href="#collapseExample2<%=produit._id%>" role="button" aria-expanded="false" aria-controls="collapseExample">Apperçu du produit  <span class="glyphicon glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                    </a>
                    <br>
                    <p></p>
                    <div class="collapse" id="collapseExample2<%=produit._id%>">

                    <div id="carousel-example-generic2<%=produit._id%>" class="carousel slide" data-ride="carousel">
                        <!-- Indicators -->
                        <ol class="carousel-indicators">
                            <li data-target="#carousel-example-generic2<%=produit._id%>" data-slide-to="0" class="active"></li>
                            <li data-target="#carousel-example-generic2<%=produit._id%>" data-slide-to="1"></li>
                        </ol>

                        <!-- Wrapper for slides -->
                        <div style="max-height:200px;min-height:200px" class="carousel-inner" role="listbox">
                            <div class="item active fixed-height">
                                <img src="<%= produit.image[0] %>" alt="image 1">
                                <div class="carousel-caption">
                                </div>
                            </div>
                            <div class="item fixed-height">
                                <img src="<%= produit.image[1] %>" alt="image 2">
                                <div class="carousel-caption">
                                </div>
                            </div>
                        </div>

                        <!-- Controls -->
                        <a class="left carousel-control" href="#carousel-example-generic2<%=produit._id%>" role="button" data-slide="prev">
                            <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="right carousel-control" href="#carousel-example-generic2<%=produit._id%>" role="button" data-slide="next">
                            <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>
                    </div>
                    <div class="caption">
                        <h4> IMEI : <br>
                            <a><%= produit.imei %></a>
                        </h4>
                        <h4> Intitulé : <br>
                            <a><%= produit.name %></a>
                        </h4>
                        <!-- Produit Like Rating -->
                        <div>
                    <span class="badge label-primary"><i class="fas fa-thumbs-up"></i>
                        <%= produit.likes.length %></span>
                        </div>
                        <p></p>
                        <!-- Produit Star Rating -->
                        <% if (produit.rating === 0) { %>
                            <p></p>
                            <h4>Pas d'évaluations encore.</h4>
                        <% } else { %>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star <% if (produit.rating > 1.5) { %> checked <% } %>"></span>
                            <span class="fa fa-star <% if (produit.rating > 2.5) { %> checked <% } %>"></span>
                            <span class="fa fa-star <% if (produit.rating > 3.5) { %> checked <% } %>"></span>
                            <span class="fa fa-star <% if (produit.rating > 4.5) { %> checked <% } %>"></span>
                        <% } %>

                        <h4>----------------------------------------------------</h4>
                        <p></p>
                        <p>
                            <a href="/produits/<%= produit._id %>" class="btn btn-success">Plus d'infos</a>
                        </p>

                    </div>

                </div>
            <% } %>

            <% if(produit.image.length === 1){ %>
                <div class="thumbnail">
                    <a style="margin-top:5px;" class="btn btn-primary" data-toggle="collapse" href="#collapseExample1<%=produit._id%>" role="button" aria-expanded="false" aria-controls="collapseExample">Apperçu du produit  <span class="glyphicon glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                    </a>
                    <br>
                    <p></p>
                    <div class="collapse" id="collapseExample1<%=produit._id%>">
                    <div id="carousel-example-generic1<%=produit._id%>" class="carousel slide" data-ride="carousel">
                        <!-- Indicators -->
                        <ol class="carousel-indicators">
                            <li data-target="#carousel-example-generic1<%=produit._id%>" data-slide-to="0" class="active"></li>
                        </ol>
                        <!-- Wrapper for slides -->
                        <div style="max-height:200px;min-height:200px" class="carousel-inner" role="listbox">
                            <div class="item active fixed-height">
                                <img src="<%= produit.image[0] %>" alt="image 1">
                                <div class="carousel-caption">
                                </div>
                            </div>
                        </div>

                        <!-- Controls -->
                        <a class="left carousel-control" href="#carousel-example-generic1<%=produit._id%>" role="button" data-slide="prev">
                            <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="right carousel-control" href="#carousel-example-generic1<%=produit._id%>" role="button" data-slide="next">
                            <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>
                    </div>
                    <div class="caption">
                        <h4> IMEI : <br>
                            <a><%= produit.imei %></a>
                        </h4>
                        <h4> Intitulé : <br>
                            <a><%= produit.name %></a>
                        </h4>
                        <!-- Produit Like Rating -->
                        <div>
                    <span class="badge label-primary"><i class="fas fa-thumbs-up"></i>
                        <%= produit.likes.length %></span>
                        </div>
                        <p></p>
                        <!-- Produit Star Rating -->
                        <% if (produit.rating === 0) { %>
                            <p></p>
                            <h4>Pas d'évaluations encore.</h4>
                        <% } else { %>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star <% if (produit.rating > 1.5) { %> checked <% } %>"></span>
                            <span class="fa fa-star <% if (produit.rating > 2.5) { %> checked <% } %>"></span>
                            <span class="fa fa-star <% if (produit.rating > 3.5) { %> checked <% } %>"></span>
                            <span class="fa fa-star <% if (produit.rating > 4.5) { %> checked <% } %>"></span>
                        <% } %>

                        <h4>----------------------------------------------------</h4>
                        <p></p>
                        <p>
                            <a href="/produits/<%= produit._id %>" class="btn btn-success">Plus d'infos</a>
                        </p>

                    </div>

                </div>
            <% } %>


    </div>

        <% } %>
        <% }); %>

            <% if((typeof (currentUser) !="undefined")) {%>
              <% if((currentUser.role ==="admin") || (currentUser.role ==="agent" )) {%>

            <% produits.forEach(produit => { %>
                    <% if ((produit.publication === "Non Publié")) { %>
            <div class="col-lg-3 col-md-4 col-sm-6">
                <div class="thumbnail">
                    <img src="<%= produit.image %>">
                    <div class="caption">
                        <h4>
                            <%= produit.name %>
                        </h4>
                        <!-- Produit Like Rating -->
                        <div>
                    <span class="badge label-primary"><i class="fas fa-thumbs-up"></i>
                        <%= produit.likes.length %></span>
                        </div>
                        <!-- Produit Star Rating -->
                        <% if (produit.rating === 0) { %>
                            <p></p>
                            <h4>Pas d'évaluations encore.</h4>
                        <% } else { %>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star <% if (produit.rating > 1.5) { %> checked <% } %>"></span>
                            <span class="fa fa-star <% if (produit.rating > 2.5) { %> checked <% } %>"></span>
                            <span class="fa fa-star <% if (produit.rating > 3.5) { %> checked <% } %>"></span>
                            <span class="fa fa-star <% if (produit.rating > 4.5) { %> checked <% } %>"></span>
                        <% } %>
                        <h4><h4 style="color: #e36c56; font-family: bold">La publication du produit: </h4><%= produit.publication%></h4>
                        <h4><h4 style="color: #54cf27; font-family: bold">Le nombre de messages reçus: </h4><%= produit.messages.length%></h4>
                        <h4><h4 style="color: midnightblue; font-family: bold">Le type du produit: </h4><%= produit.type%></h4>
                        <h4><h4 style="color: midnightblue; font-family: bold">Le modèle du produit: </h4><%= produit.modele%></h4>
                        <h4><h4 style="color: midnightblue; font-family: bold">Le statut du produit: </h4><%= produit.status%></h4>

                    </div>

                    <p>
                        <a href="/produits/<%= produit._id %>" class="btn btn-primary">Historique du produit</a>

                    </p>

                </div>

               </div>

                    <% } %>

                <% }); %>

            <% } %>
        <% } %>
</div>

<div class="row text-center">
    <% if (pages && pages > 0) { %>
    <ul class="pagination text-center">
        <% if (current == 1) { %>
        <li class="disabled"><a>Première</a></li>
        <% } else { %>
        <li><a href="/produits<%if(search){%>?search=<%=search%><%}%>">Première</a></li>
            <% } %>
     
            <% if (current == 1) { %>
            <li class=" disabled"><a>«</a></li>
        <% } else { %>
        <li><a href="/produits?page=<%= Number(current) - 1 %><%if(search){%>&search=<%=search%><%}%>">«</a></li>
            <% } %>
     
            <% var i = (Number(current) > 5 ? Number(current) - 4 : 1) %>
            <% if (i !== 1) { %>
            <li class=" disabled"><a>...</a></li>
        <% } %>
        <% for (; i <= (Number(current) + 4) && i <= pages; i++) { %>
        <% if (i == current) { %>
        <li class="active"><a><%= i %></a></li>
        <% } else { %>
        <li><a href="/produits?page=<%= i %><%if(search){%>&search=<%=search%><%}%>"><%= i %></a></li>
            <% } %>
            <% if (i == Number(current) + 4 && i < pages) { %>
            <li class=" disabled"><a>...</a></li>
        <% } %>
        <% } %>

        <% if (current == pages) { %>
        <li class="disabled"><a>»</a></li>
        <% } else { %>
        <li><a href="/produits?page=<%= Number(current) + 1 %><%if(search){%>&search=<%=search%><%}%>">»</a></li>
            <% } %>
     
            <% if (current == pages) { %>
            <li class=" disabled"><a>Dernière</a></li>
        <% } else { %>
        <li><a href="/produits?page=<%= pages %><%if(search){%>&search=<%=search%><%}%>">Dernière</a></li>
            <% } %>
        </ul>
        <% } %>
</div>





<% include ../partials/footer %>
